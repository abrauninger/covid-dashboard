## -*- coding: utf-8 -*-

<html>

<head>
<title>COVID-19 metrics for King County, WA</title>

<meta name="viewport" content="width=device-width; initial-scale=1.0;" />

<link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro&display=swap" rel="stylesheet">

<style>
	body {
		font-family: 'Source Serif Pro', serif;
	}

	h2 {
		margin-top: 36px;
	}

	table {
		border-top: 1px solid #ccc;
		border-bottom: 1px solid #ccc;
		border-collapse: collapse;
	}

	table.data-sources-desktop {
		display: none;
	}

	tr.border-bottom {
		border-bottom: 1px solid #ccc;
	}

	th {
		text-align: left;
		padding-right: 20px;
	}

	table.data-sources-desktop th.not-first-column {
		padding-left: 20px;
	}

	td {
		vertical-align: top;
	}

	td.not-first-column {
		padding-left: 20px;
		padding-right: 20px;
	}

	table.data-sources-mobile td {
		border: none;
		font-size: 90%;
	}

	ul {
		padding-left: 20px;
	}

	table.data-sources-mobile td.not-first-column {
		border: none;
	}

	table.data-sources-mobile ul {
		margin-top: 0;
		margin-bottom: 0;
	}

	.body-container {
		max-width: 1200px;
	}

	.plot-container {
		height: 200px;
	}

	.plot-notes {
		font-size: 14px;
	}

	.source-attribution {
		text-align: right;
		font-family: 'Open Sans', verdana, arial, sans-serif;
		font-size: 12px;
		font-style: italic;
		margin-top: 4px;
		margin-bottom: 28px;
	}

	code {
		font-size: 16px;
		background-color: #eee;
		padding-left: 6px;
		padding-right: 6px;
	}

	.mask-up-img {
		max-width: 100%;
		display: block;
		margin-left: auto;
		margin-right: auto;
	}

	@media only screen and (min-width: 600px) {
		.mask-up-img  {
			max-width: 600px;
		}
	}

	@media only screen and (min-width: 800px) {
		table.data-sources-desktop {
			display: inherit;
			margin-top: 24px;
			margin-bottom: 24px;
		}

		table.data-sources-mobile {
			display: none;
		}

		.plot-container {
			height: 300px;
		}

		.source-attribution {
			margin-bottom: 40px;
		}
	}
</style>

<script>
	// For Plotly plots to be usable in a mobile browser, we can specify `'staticPlot': true` to turn off all interactions,
	// but that disables hovering over datapoints on desktop, which several users have requested.
	// If we *don't* specify `'staticPlot': true`, the plots are pretty hard to use on mobile because they intercept
	// touch gestures and make it difficult to scroll the page.
	// See https://github.com/plotly/plotly.js/issues/2844 (still active as of 9/11/2020).
	// To work around this limitation, we don't specify `'staticPlot': true` by default, and here we detect a mobile
	// browser and programmatically set `staticPlot` to true on mobile.

	// https://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-mobile-device
	let isMobile = window.matchMedia("only screen and (max-width: 800px)").matches;

	if (isMobile) {
		document.addEventListener("DOMContentLoaded", function() {
		    document.querySelectorAll('.plotly-graph-div').forEach(graphDiv => Plotly.plot(graphDiv, [], {}, {'staticPlot': true}))
		});
	}
</script>

</head>

<body>

<div class="body-container">

<h1>COVID-19 metrics for King County, WA</h1>

<p>A more readable and more mobile-friendly version of the <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">King County COVID-19 Dashboard</a>.

<p>Note that the King County dashboard has more recent data and shows more metrics.  But good luck using it on your phone. &#128512</p>

<p>Most data on this page is from the King County Department of Health, with some supplemental data from the New York Times.</p>

<p>Last updated <strong>${page_updated_date}</strong>.</p>


<h2>New cases</h2>

<div class="plot-container">
${new_cases_plot}
</div>

<div class="plot-notes">
<p><strong>Notes:</strong></p>
<ul>
	<li>For the shaded area, data was not available to download from the King County Department of Health.</li>
	<li>The <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">county&rsquo;s own dashboard</a> may have more up-to-date data on new cases.</li>
	<li>The shaded area is filled in with data from the New York Times&rsquo;s dataset for King County, scaled slightly to represent the average discrepancy between the two datasets.</li>
</ul>
</div>

<h2>Hospitalizations</h2>

<div class="plot-container">
${hospitalizations_plot}
</div>

<div class="plot-notes">
<p><strong>Notes:</strong></p>
<ul>
	<li>For the shaded area, some data was available to download from the King County Department of Health, but it is most likely undercounted due to a lag in reporting hospitaliations.</li>
	<li>The <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">county&rsquo;s own dashboard</a> may have more up-to-date data on hospitalizations.</li>
</ul>
</div>


<h2>Deaths</h2>

<div class="plot-container">
${deaths_plot}
</div>

<div class="plot-notes">
<p><strong>Notes:</strong></p>
<ul>
	<li>For the shaded area, some data was available to download from the King County Department of Health, but it is most likely undercounted due to a lag in reporting deaths.</li>
	<li>The <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">county&rsquo;s own dashboard</a> may have more up-to-date data on deaths.</li>
	<li>The shaded area is filled in with data from the New York Times&rsquo;s dataset for King County, scaled slightly to represent the average discrepancy between the two datasets.</li>
</ul>
</div>


<h2>Tests</h2>

<div class="plot-container">
${tests_plot}
</div>

<div class="plot-notes">
<p><strong>Notes:</strong></p>
<ul>
	<li>For the shaded area, some data was available to download from the King County Department of Health, but it is most likely undercounted due to a lag in reporting tests.</li>
	<li>The <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">county&rsquo;s own dashboard</a> may have more up-to-date data on tests.
</ul>
</div>


<h2>Positive test rate</h2>

<div class="plot-container">
${positive_test_rate_plot}
</div>

<div class="plot-notes">
<p><strong>Notes:</strong></p>
<ul>
	<li>This plot is drawn using data from the King County Department of Health, but it differs significantly in magnitude from the county&rsquo;s own &ldquo;test positivity&rdquo; metric.  See <strong>Definitions</strong> below for more details.</li>
	<li>For the shaded area, some data was available to download from the King County Department of Health, but it is most likely inaccurate due to a lag in reporting tests.</li>
	<li>The <a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">county&rsquo;s own dashboard</a> may have more up-to-date data on tests and test positivity.
</ul>
</div>


<h2>Definitions</h2>

<p><strong>New cases:</strong> Unique people receiving a positive test result each day.</p>
<p><strong>Tests:</strong> Unique people receiving a test result each day.</p>
<p><strong>Positive test rate:</strong> <em>New cases</em> divided by <em>Tests</em>.</p>
<p>Note this definition of positive test rate differs from King County&rsquo;s own &ldquo;test positivity&rdquo; metric.  It&rsquo;s unclear to me how King County calculates &ldquo;test positivity,&rdquo; but I presume it is calculated as the percentage of total test results that are positive.  This metric would potentially double-count individuals who are tested more than once.</p>
<p>King County&rsquo;s public data download does not include total positive test results, so instead of that simple metric, I am using the definition of &ldquo;positive test rate&rdquo; that divides the unique-person metrics of <em>New cases</em> and <em>Tests</em>.  The unique-person metric is usually much higher in magnitude than the per-test metric that is reported by the county, but the shapes of the two curves are quite similar.</p>

<p>See King County&rsquo;s <a href="https://www.kingcounty.gov/depts/health/covid-19/data/daily-summary/extracts.aspx">data definitions and notes</a> for more details on each metric.</p>


<h2 class="h2-at-end-of-page">Data sources</h2>

<table class="data-sources-desktop">
	<thead>
		<tr class="border-bottom"><th>Source</th><th class="not-first-column">Used for</th><th class="not-first-column">Availability</th><th class="not-first-column">Last pulled</th></tr>
	</thead>
	<tbody>
		<tr class="border-bottom"><td><a href="https://www.kingcounty.gov/depts/health/covid-19/data/daily-summary.aspx">King County Department of Health</a></td><td class="not-first-column"><ul><li>New cases</li><li>Hospitalizations</li><li>Tests</li><li>Deaths</li></ul></td><td class="not-first-column">Every Tuesday</td><td class="not-first-column"><strong>${king_county_pull_date}</strong></td></tr>
		<tr><td><a href="https://github.com/nytimes/covid-19-data">New York Times</a></td><td class="not-first-column"><ul><li>New cases (recent)</li><li>Deaths (recent)</li></ul></td><td class="not-first-column">Many times per day</td><td class="not-first-column"><strong>${nytimes_pull_date}</strong></td></tr>
	</tbody>
</table>

<table class="data-sources-mobile">
	<tbody>
		<tr><td>Source:</td><td class="not-first-column"><a href="https://www.kingcounty.gov/depts/health/covid-19/data/daily-summary.aspx">King County Department of Health</a></td></tr>
		<tr><td>Used for:</td><td class="not-first-column"><ul><li>New cases</li><li>Hospitalizations</li><li>Tests</li><li>Deaths</li></ul></td></tr>
		<tr><td>Availability:</td><td class="not-first-column">Every Tuesday</td></tr>
		<tr class="border-bottom"><td>Last pulled:</td><td class="not-first-column"><strong>${king_county_pull_date}</strong></td></tr>
		<tr><td>Source:</td><td class="not-first-column"><a href="https://github.com/nytimes/covid-19-data">New York Times</a></td></tr>
		<tr><td>Used for:</td><td class="not-first-column"><ul><li>New cases (recent)</li><li>Deaths (recent)</li></ul></td></tr>
		<tr><td>Availability:</td><td class="not-first-column">Many times per day</td></tr>
		<tr class="border-bottom"><td>Last pulled:</td><td class="not-first-column"><strong>${nytimes_pull_date}</strong></td></tr>
	</tbody>
</table>

<p>The King County Department of Health has the highest quality data but only updates weekly (and sometimes less frequently than that).</p>

<p>For recent data, I use the New York Times data which updates daily; it is noisier than the King County data but over time it tracks reasonably closely with the King County data, so it can serve as a good approximation for recent days that haven&rsquo;t been reported yet by the King County Department of Health.</p>


<h2 class="h2-at-end-of-page">Source code</h2>

<p>The code that generated this page is available in the <a href="https://github.com/abrauninger/covid-dashboard"><code>covid-dashboard</code></a> repository on GitHub.</p>


<h2 class="h2-at-end-of-page">Other resources</h2>

<p>You may find these helpful:</p>

<table>
	<thead>
		<tr class="border-bottom"><th>Site</th><th>Notes</th></tr>
	</thead>
	<tbody>
		<tr class="border-bottom"><td><a href="https://public.tableau.com/profile/public.health.seattle.king.county.covid#!/vizhome/PHSKCOverviewDashboard/Overview">King County Overview Dashboard</a></td><td><ul><li>Metrics per individual city</li><li>Not very usable on the phone, but excellent on a larger screen</li></ul></td></tr>
		<tr class="border-bottom"><td><a href="https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html">New York Times "Covid in the U.S."</a></td><td><ul><li>Excellent nationwide data and per-state data</li><li>Fantastic visualizations, maps, and charts</li><li>Doesn&rsquo;t show testing or hopsitalization data</li></ul></td></tr>
		<tr><td><a href="https://coronavirus.jhu.edu/map.html">Johns Hopkins COVID-19 Dashboard</a></td><td><ul><li>Perhaps the most authoritative source for world-wide COVID data</li></ul></td></tr>
	</tbody>
</table>


<h2 class="h2-at-end-of-page">Wear a mask</h2>

<p>Stay healthy out there.</p>

<a href="https://coronavirus.wa.gov/masks"><img class="mask-up-img" src="DOH-COVID19-MaskUp-970x250-ENG.gif" /></a>

</div>

</body>

</html>